setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
athl %>% group_by(Jahr) %>% filter(Land == "TUR") %>% summarize(n = length(unique(Name)))
length(unique(cases$Name))
setwd("/Users/administrator/Desktop/doping olympische spiele")
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
cpy <- cases %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(count=sum(count))# %>% arrange(-count)
write.csv(cpy, "fälleprojahr.csv", row.names = F)
#fälle pro land
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
#fälle pro disziplin
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
#fälle pro kategorie
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
write.csv(cpk, "fälleprokategorie.csv", row.names = F)
#fälle nach geschlecht
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
#fälle nach geschlecht und jahr
cpgy <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(sum=length(unique(Name)))
cpgy <- left_join(cpgy, tmp, by=c("Geschlecht","Jahr")) %>% mutate(norm = count/sum)
write.csv(cpg, "fällenachgeschlecht.csv", row.names = F)
write.csv(cpgy, "fällenachgeschlechtundjahr.csv", row.names = F)
View(cpc)
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
View(cpc)
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
View(x)
x$sum[6]
x$sum[6]
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
View(tmp)
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count)) %>%
filter(Land != "Türkei" & Land != "Russland" & Land != "Belarus" & Land != "Ukraine" & Land != "USA")
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count)) %>%
filter(Land != "Türkei" & Land != "Russland" & Land != "Belarus" & Land != "Ukraine" & Land != "USA" & Land != "")
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count)) %>%
filter(Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA" & Land != "")
sum(tmp$sum)
x$sum[6] <- sum(tmp$sum)
x$sum[6] <- sum(tmp$sum); x$norm[6] <- x$count[6] / x$sum[6]
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
#sonstiges summe und norm
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp2 = filter(tmp, Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA")
x$sum[6] <- sum(tmp2$sum); x$norm[6] <- x$count[6] / x$sum[6]
#gesamtdurchschnitt
cmean = sum(cpc$count)/sum(tmp$sum) #0.01231637
cmean
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", round(cmean,4))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
tests <- read.csv("testnrs.csv")
View(tests)
tests <- read.csv("testnrs.csv")[1:3]
?read.csv
tests$Number.of.tests <- as.numeric(gsub(",","",tests$Number.of.tests))
tests <- read.csv("testnrs.csv")[c(1,3)]
tests$Number.of.tests <- as.numeric(gsub(",","",tests$Number.of.tests))
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
tmp <- athl %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(sum = sum(count))
View(tmp)
cpy <- left_join(cpy, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
View(cpy)
cpy <- left_join(cpy, tmp, by=c("Jahr")) %>% mutate(norm = count/sum)
write.csv(cpy, "fälleprojahr.csv", row.names = F)
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1)
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)+ scale_y_continuous(labels=percent)
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)+ scale_y_continuous(labels=scales::percent)
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)#+ scale_y_continuous(labels=scales::percent)
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent)
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", round(cmean,4))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", round(cmean,4))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", paste0(round(cmean*100,2),"%"))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
#fälle pro jahr
cpy <- cases %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(count=sum(count))# %>% arrange(-count)
tmp <- athl %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(sum = sum(count))
cpy <- left_join(cpy, tmp, by=c("Jahr")) %>% mutate(norm = count/sum)
write.csv(cpy, "fälleprojahr.csv", row.names = F)
#fälle pro land
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
#fälle pro disziplin
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
#fälle pro kategorie
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
write.csv(cpk, "fälleprokategorie.csv", row.names = F)
#fälle nach geschlecht
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
#fälle nach geschlecht und jahr
cpgy <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(sum=length(unique(Name)))
cpgy <- left_join(cpgy, tmp, by=c("Geschlecht","Jahr")) %>% mutate(norm = count/sum)
write.csv(cpg, "fällenachgeschlecht.csv", row.names = F)
write.csv(cpgy, "fällenachgeschlechtundjahr.csv", row.names = F)
#tests pro jahr
tests <- read.csv("testnrs.csv")[c(1,3)]
tests$Number.of.tests <- as.numeric(gsub(",","",tests$Number.of.tests))
save.image(file="datasets.Rdata")
pdf("results/alle-normiert.pdf", width=14)
#fälle pro jahr
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)
#fälle pro jahr normiert
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
#tests pro jahr
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
#sonstiges summe und norm
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp2 = filter(tmp, Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA")
x$sum[6] <- sum(tmp2$sum); x$norm[6] <- x$count[6] / x$sum[6]
#gesamtdurchschnitt
cmean = sum(cpc$count)/sum(tmp$sum) #0.00514601
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", paste0(round(cmean*100,2),"%"))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach
dev.off()
View(cpy)
pdf("results/alle-normiert.pdf", width=14)
#fälle pro jahr
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)
'
#fälle pro jahr normiert
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
'
#tests pro jahr
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
#sonstiges summe und norm
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp2 = filter(tmp, Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA")
x$sum[6] <- sum(tmp2$sum); x$norm[6] <- x$count[6] / x$sum[6]
#gesamtdurchschnitt
cmean = sum(cpc$count)/sum(tmp$sum) #0.00514601
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", paste0(round(cmean*100,2),"%"))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht und jahr
'cpgy <- cpgy %>% ungroup %>% arrange(-norm)
ggplot(cpgy, aes(x=Jahr, y=norm, fill=Geschlecht)) + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +theme_minimal() +
geom_bar(stat="identity",position="dodge") + ggtitle("Doping-Fälle nach Geschlecht und Jahr") +
theme(legend.position="bottom", panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=3.5), aes(x=Jahr, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro disziplin
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro kategorie
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste0(count,"/",sum)), vjust=-0.5)
'
dev.off()
pdf("results/alle-normiert.pdf", width=14)
#fälle pro jahr
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)
'
#fälle pro jahr normiert
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
'
#tests pro jahr
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
#sonstiges summe und norm
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp2 = filter(tmp, Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA")
x$sum[6] <- sum(tmp2$sum); x$norm[6] <- x$count[6] / x$sum[6]
#gesamtdurchschnitt
cmean = sum(cpc$count)/sum(tmp$sum) #0.00514601
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Anteil überführter Athleten nach Land") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", paste0(round(cmean*100,2),"%"))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Anteil überführter Athleten nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht und jahr
'cpgy <- cpgy %>% ungroup %>% arrange(-norm)
ggplot(cpgy, aes(x=Jahr, y=norm, fill=Geschlecht)) + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +theme_minimal() +
geom_bar(stat="identity",position="dodge") + ggtitle("Doping-Fälle nach Geschlecht und Jahr") +
theme(legend.position="bottom", panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=3.5), aes(x=Jahr, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro disziplin
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro kategorie
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste0(count,"/",sum)), vjust=-0.5)
'
dev.off()
rm(list=ls())
setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("participants-by-event.csv", quote="", encoding="utf-8", sep=";")
View(athl)
cpy <- cases %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(count=sum(count))# %>% arrange(-count)
tmp <- athl %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(sum = sum(count))
cpy <- left_join(cpy, tmp, by=c("Jahr")) %>% mutate(norm = count/sum)
View(cpy)
names(athl)
names(athl) = c("Jahr","Ort","Name","Land","Geschlecht","Sport","Disziplin","Medal")
names(athl)
cpy <- cases %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(count=sum(count))# %>% arrange(-count)
tmp <- athl %>% group_by(Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Jahr) %>% summarize(sum = sum(count))
cpy <- left_join(cpy, tmp, by=c("Jahr")) %>% mutate(norm = count/sum)
View(cpy)
View(tmp)
write.csv(cpy, "fälleprojahr.csv", row.names = F)
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
View(cpc)
#fälle pro disziplin
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
View(cpd)
#fälle nach geschlecht
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
#fälle nach geschlecht und jahr
cpgy <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(sum=length(unique(Name)))
cpgy <- left_join(cpgy, tmp, by=c("Geschlecht","Jahr")) %>% mutate(norm = count/sum)
write.csv(cpg, "fällenachgeschlecht.csv", row.names = F)
write.csv(cpgy, "fällenachgeschlechtundjahr.csv", row.names = F)
#fälle nach geschlecht
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
#fälle nach geschlecht und jahr
cpgy <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(sum=length(unique(Name)))
cpgy <- left_join(cpgy, tmp, by=c("Geschlecht","Jahr")) %>% mutate(norm = count/sum)
write.csv(cpg, "fällenachgeschlecht.csv", row.names = F)
write.csv(cpgy, "fällenachgeschlechtundjahr.csv", row.names = F)
View(cpg)
View(cpgy)
tests <- read.csv("testnrs.csv")[c(1,3)]
tests$Number.of.tests <- as.numeric(gsub(",","",tests$Number.of.tests))
save.image(file="datasets.Rdata")
pdf("results/alle-normiert.pdf", width=14)
#fälle pro jahr
ggplot(cpy, aes(x=Jahr, y=count)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Doping-Fälle über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(count)), vjust=-1)
'
#fälle pro jahr normiert
ggplot(cpy, aes(x=Jahr, y=norm)) + theme_light() + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +
ggtitle("Anteil überführter Athleten über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Jahr, label=paste0(round(norm*100, 2),"%")), vjust=-1) + scale_y_continuous(labels=scales::percent)
'
#tests pro jahr
ggplot(tests, aes(x=Year, y=Number.of.tests)) + theme_light() + scale_x_continuous(breaks = rev(unique(tests$Year))) +
ggtitle("Doping-Tests über die Jahre") + geom_line(colour="orange") + geom_point() +
geom_text(aes(x=Year, label=paste0(Number.of.tests)), vjust=-1)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=c("Türkei", "Russland","Belarus","Ukraine","USA","Sonstige"))) %>%
group_by(Land) %>% summarize(count=sum(count), sum=sum(sum), norm=count/sum)
#sonstiges summe und norm
tmp <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp2 = filter(tmp, Land != "TUR" & Land != "RUS" & Land != "BLR" & Land != "UKR" & Land != "USA")
x$sum[6] <- sum(tmp2$sum); x$norm[6] <- x$count[6] / x$sum[6]
#gesamtdurchschnitt
cmean = sum(cpc$count)/sum(tmp$sum) #0.00514601
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal()  + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Anteil überführter Athleten nach Land") +
geom_hline(yintercept = cmean) + theme(legend.position="none") +
geom_text(aes(x=1, y=cmean, label=paste("Gesamtdurchschnitt =", paste0(round(cmean*100,2),"%"))), hjust=0,vjust=-0.5)+
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) + theme_minimal() + scale_y_continuous(labels=scales::percent) +
geom_bar(stat="identity") + ggtitle("Anteil überführter Athleten nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle nach geschlecht und jahr
'cpgy <- cpgy %>% ungroup %>% arrange(-norm)
ggplot(cpgy, aes(x=Jahr, y=norm, fill=Geschlecht)) + scale_x_continuous(breaks = rev(unique(cpgy$Jahr))) +theme_minimal() +
geom_bar(stat="identity",position="dodge") + ggtitle("Doping-Fälle nach Geschlecht und Jahr") +
theme(legend.position="bottom", panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=3.5), aes(x=Jahr, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro disziplin
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste0(count,"/",sum)), vjust=-0.5)
#fälle pro kategorie
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste0(count,"/",sum)), vjust=-0.5)
'
dev.off()
athlwiki <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
wiki <- athlwiki %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
ioc <- athl %>% group_by(Land, Jahr, Geschlecht) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
View(ioc)
View(wiki)
View(cpc)
cpc <- left_join(cpc, wiki, by="Land") %>% arrange(-count)
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
cpc <- left_join(cpc, wiki, by=c("COUNTRY"=="Land")) %>% arrange(-count)
cpc <- left_join(cpc, wiki, by=c("COUNTRY"="Land")) %>% arrange(-count)
View(athl)
