nuernberg <- full_join(nuernberg,all3, by="profile_link")
rm(list=ls())
setwd("/home/kira/ownCloud/BR Data/doping olympische spiele")
library(dplyr)
setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F)
athl <- read.csv("LA-teilnehmer.csv", stringsAsFactors = F)
list.files()
athl <- read.csv("LA-teilnehmer.csv", stringsAsFactors = F, quote="")
athl <- read.csv("LA-teilnehmer.csv", stringsAsFactors = F, quote=NULL)
?read.csv
athl <- read.csv("LA-teilnehmer.csv", quote="")
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
View(athl)
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8")
View(athl)
View(athl)
cpc <- cases %>% group_by(Land) %>% summarize(count=length(unique(Name)))
cpc <- cpc %>% arrange(-count)
View(cpc)
View(cases)
cpc <- cases %>% group_by(COUNTRY, Land) %>% summarize(count=length(unique(Name)))
cpc <- cpc %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name)))
View(tmp)
unique(athl$Jahr)
?read.csv
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
cpc <- cases %>% group_by(COUNTRY, Land) %>% summarize(count=length(unique(Name)))
unique(athl$Jahr)
cpc <- cpc %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name)))
View(tmp)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) #%>%
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
cpc <- cases %>% group_by(COUNTRY, Land) %>% summarize(count=length(unique(Name)))
cpc <- cpc %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
cpc <- mutate(cpc,Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
cpc <- mutate(cpc, Land = factor(cpc$Land, levels=unique(cpc$Land))) %>%
group_by(Land) %>% summarize(count=sum(count))
write.csv(cpc, "fälleproland.csv", row.names = F)
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count))
cpc <- cpc %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) #%>%
cpc <- cases %>% group_by(COUNTRY, Land) %>% summarize(count=length(unique(Name))) #%>%
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) #%>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count))
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) #%>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count))
setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) #%>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count))
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count))
cpc <- cpc %>% arrange(-count)
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count) %>%
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Land,Disziplin) %>% summarize(count=n())
tmp <- athl %>% group_by(Disziplin) %>% summarize(count=n())
cpc <- left_join(cpc, tmp, by="Disziplin") %>% mutate(norm = count/sum)
View(tmp)
cpc <- left_join(cpc, tmp, by="Disziplin") #%>% mutate(norm = count/sum)
x <- left_join(cpc, tmp) #%>% mutate(norm = count/sum)
x <- left_join(cpc, tmp, by="Disziplin") #%>% mutate(norm = count/sum)
x <- left_join(cpc, tmp, by=Disziplin) #%>% mutate(norm = count/sum)
x <- left_join(cpc, tmp, by=c("Disziplin"="Disziplin")) #%>% mutate(norm = count/sum)
paste(names(tmp))
paste(names(cpd))
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
x <- left_join(cpc, tmp, by=c("Disziplin"="Disziplin")) #%>% mutate(norm = count/sum)
paste(names(cpd))
x <- left_join(cpc, tmp) #%>% mutate(norm = count/sum)
x <- left_join(cpd, tmp, by="Disziplin") #%>% mutate(norm = count/sum)
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
View(cpd)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
View(cpk)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
View(athl)
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
write.csv(cpk, "fälleprokategorie.csv", row.names = F)
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
View(cpg)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
View(athl)
write.csv(cpk, "fällenachgeschlecht.csv", row.names = F)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) #%>%
View(tmp)
View(cpc)
View(cpd)
View(cpg)
View(cpk)
View(cpg)
rm(x)
save.image(file="datasets.Rdata")
library(ggplot2)
cpc <- mutate(cpc,Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5))
cpc <- arrange(-count) %>% mutate(cpc,Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
length(cpc$Land)-5
x <- arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- arrange(-as.numeric(count)) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- cpc %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
?ungroup
x <- cpc %>% ungroup %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
View(x)
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land)))# %>%
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
x <- cpc %>% ungroup %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- cpc %>% ungroup %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count))
x <- cpc %>% ungroup %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count), norm=mean(norm))
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") + theme(legend.position="none") +
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=count), vjust=-0.5)
x <- cpc %>% ungroup %>% arrange(-count) %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
cpc <- arrange(cpc, -count)
x <- cpc %>% ungroup %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
View(cpc)
View(arrange(cpc, -count))
View(arrange(cpc, count))
cpc <- cpc %>% arrange(-count)
cpc <- cpc %>% arrange(-"count")
count
cpc <- cpc %>% arrange(-count)
View(cpc)
cpc <- cpc %>% ungroup %>% arrange(-count)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count), norm=mean(norm))
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") + theme(legend.position="none") +
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste("Fälle:",count)), vjust=-0.5)
cpc <- cpc %>% ungroup %>% arrange(-norm)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count), norm=mean(norm))
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") + theme(legend.position="none") +
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste("Fälle:",count)), vjust=-0.5)
?pdf
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=count, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=count), vjust=-0.5)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=count), vjust=-0.5)
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste("Fälle:",count)), vjust=-0.5)
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste(count,"Fälle")), vjust=-0.5)
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
cpg <- cpg %>% ungroup %>% arrange(-norm)
cpg$Kategorie <- factor(cpg$Kategorie, levels=unique(cpg$Kategorie))
ggplot(cpg, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
ggplot(cpg, aes(x=Geschlech, y=norm, fill=Geschlecht)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste(count,"Fälle")), vjust=-0.5)
pdf("results/alle-normiert.pdf", width=14)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-norm)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count), norm=mean(norm))
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") + theme(legend.position="none") +
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste(count,"Fälle")), vjust=-0.5)
#fälle pro disziplin
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste(count,"Fälle")), vjust=-0.5)
#fälle pro kategorie
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste(count,"Fälle")), vjust=-0.5)
dev.off()
View(cpc)
View(tmp)
View(cases)
tmp <- athl %>% group_by(Jahr, Disziplin, Geschlecht) %>% summarize(count= n())
View(tmp)
setwd("/Users/administrator/Desktop/doping olympische spiele/scraping")
rm(list=ls())
setwd("/Users/administrator/Desktop/doping olympische spiele/scraping")
library(rvest)
library(dplyr)
athlinks <- read_html("https://www.olympic.org/olympic-games") %>% html_nodes("li.summergames") %>%
html_nodes("a") %>% html_attr("href")
athlinks <- paste0("https://www.olympic.org", athlinks,"/athletics")[-(1:2)]
athlinks
years <- list()
for(i in 1:4){
#liste der links zu den disziplinen
disclinks <- read_html(athlinks[i]) %>% html_nodes("a") %>%
html_attr("href") %>% subset(grepl(pattern='^/.*/athletics/', x=.)) %>% unique
#für jedes jahr eine liste in der liste machen, die alle tabellen der disziplinen enthält
discs <- list()
for(j in 1:length(disclinks)){
print(disclinks[j])
discs[[j]] <- read_html(paste0("https://www.olympic.org", disclinks[j])) %>%
html_nodes("table") %>% html_table(fill=T)
names(discs)[j] <- disclinks[j]
}
years[[i]] <- discs
names(years)[i] <- athlinks[i]
}
str(years, max.level = 1)
str(years[[1]], max.level = 1)
str(years[[1]][[1]], max.level = 1)
years[[1]][[1]]
x <- lapply(years, function(year) lapply(year, function(discdata) discdata <- discdata[,1:4]))
x <- lapply(years, function(year) lapply(year, function(discdata) lapply(discdata, function(i) i <- i[,1:4]))
x <- lapply(years, function(year) lapply(year, function(discdata) lapply(discdata, function(i) i <- i[,1:4])))
str(x[[1]][[1]], max.level = 1)
names(x[[1]][[1]][[1]])
names(x[[1]][[1]][[2]])
years <- lapply(years, function(year) lapply(year, function(discdata) lapply(discdata, function(i) i <- i[,1:4])))
x <- lapply(years, function(year) lapply(year, function(discdata) do.call(rbind, discdata)))
x <- lapply(years, function(year) lapply(year, function(d) lapply(d, function(discdata) setNames(discdata, c("Rank","Athlete","Result","Notes")))))
x <- lapply(x, function(year) lapply(year, function(discdata) do.call(rbind, discdata)))
str(x[[1]][[1]], max.level = 1)
years <- lapply(years, function(year) lapply(year, function(discdata) lapply(discdata, function(i) i <- i[,1:4])))
years <- lapply(years, function(year) lapply(year, function(d) lapply(d, function(discdata) setNames(discdata, c("Rank","Athlete","Result","Notes")))))
years <- lapply(years, function(year) lapply(year, function(discdata) do.call(rbind, discdata)))
str(years[[1]][[1]], max.level = 1)
str(years[[1]], max.level = 1)
View(years[[1]][[1]])
str(years[[1]], max.level = 1)
x <- lapply(years, function(year) do.call(rbind, year))
str(x[[1]], max.level = 1)
years <- lapply(years, function(year) do.call(rbind, year))
years <- lapply(years, function(year) mutate(year, Game = row.names(year)))
years <- do.call(rbind, years)
View(years)
years <- years[-grep("^Table|^Notes$", years$Notes),]
row.names(years) <- 1:nrow(years)
years <- years[,-(3:4)]
years$Rank <- ifelse(years$Rank == "G" | years$Rank == "S"| years$Rank == "B", years$Rank, "")
years$City <- substr(years$Game, 2, regexpr("-", years$Game)-1)
years$year <- substr(years$Game, regexpr("-", years$Game)+1, regexpr("/athl", years$Game)-1)
years$Discipline <- substr(years$Game, regexpr("cs/", years$Game)+3, regexpr("\\.", years$Game)-1)
years <- years[,-3]
write.csv(years, "IOC-teilnehmer.csv", row.names = F)
setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
View(athl)
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
View(cpc)
#fälle pro disziplin
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
write.csv(cpk, "fälleprokategorie.csv", row.names = F)
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
write.csv(cpk, "fällenachgeschlecht.csv", row.names = F)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name)))
rm(years, athlinks, disclinks, discs, i, j, x)
save.image(file="datasets.Rdata")
View(cpd)
tmp <- athl %>% group_by(Jahr, Disziplin, Geschlecht) %>% summarize(count= n())
View(tmp)
View(cpg)
tmp <- athl %>% group_by(Jahr, Geschlecht) %>% summarize(count= n())
View(tmp)
rm(list=ls())
wikilinks <- paste0("https://en.wikipedia.org/wiki/Athletics_at_the_",c(2012,2008,2004,2000),"_Summer_Olympics")
yearswiki <- list()
for(i in 1:length(wikilinks)){
disclinks <- read_html(wikilinks[i]) %>% html_nodes("a") %>%
html_attr("href") %>% subset(grepl(pattern='/wiki/Athletics_at_the_.*_Summer_Olympics_', x=.)) %>% unique
discs <- list()
for(j in 1:length(disclinks)){
print(disclinks[j])
discs[[j]] <- read_html(paste0("https://en.wikipedia.org", disclinks[j]))
discs[[j]] <- discs[[j]] %>% html_nodes("table")
try(discs[[j]] <- discs[[j]] %>% html_table(fill=T))
names(discs)[j] <- disclinks[j]
}
yearswiki[[i]] <- discs
names(yearswiki)[i] <- wikilinks[i]
}
names(yearswiki)
yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump` <- html_table(yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump`, fill=T)
yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump`
yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump` <- html_table(yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump`[6:9], fill=T)
yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump` <- html_table(yearswiki[[4]]$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_long_jump`[8:9], fill=T)
rm(i,j, discs, disclinks)
save.image("wikidata.Rdata")
str(years[[1]], max.level = 1)
cols <- lapply(yearswiki, function(year){
lapply(year, function(disc){
sapply(disc, function(i)( any( grepl("Rank|RANK|Athlete|Atltete", names(i)) ) ) )
})
})
for(i in 1:length(yearswiki)){
year <- yearswiki[[i]]
print(names(yearswiki)[i])
for(j in 1:length(year)){ #length(year) = anzahl disziplinen
discipline <- year[[j]]
year[[j]] <- discipline[cols[[i]][[j]]]
}
yearswiki[[i]] <- year
}
yearswiki <- lapply(yearswiki, function(year) lapply(year, function(disc) lapply(disc, function(i) setNames(i, 1:ncol(i)))))
yearswiki <- lapply(yearswiki, function(year) lapply(year, function(disc) lapply(disc, function(i) i <- i[1:min(ncol(i),4)] )))
str(yearswiki[[1]])
str(yearswiki[[1]], max.level = 1)
sapply(yearswiki, function(year) sapply(year, function(disc) sapply(disc, ncol)))
load("wikidata.Rdata")
yearswiki$`https://en.wikipedia.org/wiki/Athletics_at_the_2000_Summer_Olympics`$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_110_metres_hurdles`
View(yearswiki$`https://en.wikipedia.org/wiki/Athletics_at_the_2000_Summer_Olympics`$`/wiki/Athletics_at_the_2000_Summer_Olympics_%E2%80%93_Men%27s_110_metres_hurdles`)
cols <- lapply(yearswiki, function(year){
lapply(year, function(disc){
sapply(disc, function(i)( any( grepl("Rank|RANK|Athlete|Atltete", names(i)) | grepl("Rank|RANK|Athlete|Atltete", i[1,]) ) ))
})
})
for(i in 1:length(yearswiki)){
year <- yearswiki[[i]]
print(names(yearswiki)[i])
for(j in 1:length(year)){ #length(year) = anzahl disziplinen
discipline <- year[[j]]
year[[j]] <- discipline[cols[[i]][[j]]]
}
yearswiki[[i]] <- year
}
#na
yearswiki <- lapply(yearswiki, function(year) lapply(year, function(disc) lapply(disc, function(i) setNames(i, 1:ncol(i)))))
yearswiki <- lapply(yearswiki, function(year) lapply(year, function(disc) lapply(disc, function(i) i <- i[1:min(ncol(i),4)] )))
sapply(yearswiki, function(year) sapply(year, function(disc) sapply(disc, ncol)))
View(yearswiki$`https://en.wikipedia.org/wiki/Athletics_at_the_2008_Summer_Olympics`$`/wiki/Athletics_at_the_2008_Summer_Olympics_%E2%80%93_Men%27s_marathon`)
View(yearswiki$`https://en.wikipedia.org/wiki/Athletics_at_the_2008_Summer_Olympics`$`/wiki/Athletics_at_the_2008_Summer_Olympics_%E2%80%93_Men%27s_marathon`[2])
View(yearswiki$`https://en.wikipedia.org/wiki/Athletics_at_the_2008_Summer_Olympics`$`/wiki/Athletics_at_the_2008_Summer_Olympics_%E2%80%93_Men%27s_marathon`[1])
x <- lapply(yearswiki, function(year) lapply(year, function(disc) do.call(rbind, disc)))
yearswiki <- lapply(yearswiki, function(year) lapply(year, function(disc) do.call(rbind, disc)))
yearswiki <- lapply(yearswiki, function(year) do.call(rbind, year))
yearswiki <- do.call(rbind, yearswiki)
yearswiki$Game <- row.names(yearswiki)
View(yearswiki)
write.csv(yearswiki, "wiki-teilnehmer-ab2000.csv", row.names = F)
rm(list=ls())
setwd("/Users/administrator/Desktop/doping olympische spiele")
library(dplyr)
library(ggplot2)
cases <- read.csv("IAAF-doping-cases-clean-deutsch.csv", stringsAsFactors = F, encoding="utf-8")
athl <- read.csv("LA-teilnehmer.csv", quote="", encoding="utf-8", sep=";")
#fälle pro land
cpc <- cases %>% group_by(COUNTRY, Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(COUNTRY, Land) %>% summarize(count=sum(count)) %>% arrange(-count)
tmp <- athl %>% group_by(Land, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Land) %>% summarize(sum = sum(count))
cpc <- left_join(cpc, tmp, by=c("COUNTRY" = "Land")) %>% mutate(norm = count/sum)
write.csv(cpc, "fälleproland.csv", row.names = F)
#fälle pro disziplin
cpd <- cases %>% group_by(Disziplin) %>% summarize(count=n()) %>% arrange(-count)
tmp <- athl %>% group_by(Disziplin) %>% summarize(sum=n())
cpd <- left_join(cpd, tmp, by="Disziplin") %>% mutate(norm = count/sum)
write.csv(cpd, "fälleprodisziplin.csv", row.names = F)
#fälle pro kategorie
cpk <- cases %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Kategorie, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Kategorie) %>% summarize(sum=sum(count))
cpk <- left_join(cpk, tmp, by="Kategorie") %>% mutate(norm = count/sum)
write.csv(cpk, "fälleprokategorie.csv", row.names = F)
#fälle nach geschlecht
cpg <- cases %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(count=sum(count)) %>%arrange(-count)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name))) %>%
group_by(Geschlecht) %>% summarize(sum=sum(count))
cpg <- left_join(cpg, tmp, by="Geschlecht") %>% mutate(norm = count/sum)
write.csv(cpk, "fällenachgeschlecht.csv", row.names = F)
tmp <- athl %>% group_by(Geschlecht, Jahr) %>% summarize(count=length(unique(Name)))
View(cpc)
View(tmp)
save.image(file="datasets.Rdata")
library(ggplot2)
pdf("results/alle-normiert.pdf", width=14)
#fälle pro land
#sonstiges kategorie einrichten
cpc <- cpc %>% ungroup %>% arrange(-norm)
x <- cpc %>% mutate(Land = c(cpc$Land[1:5], rep("Sonstige",length(cpc$Land)-5)))
x <- mutate(x, Land = factor(x$Land, levels=unique(x$Land))) %>%
group_by(Land) %>% summarize(count=sum(count), norm=mean(norm))
ggplot(x, aes(x=Land, y=norm, fill=Land)) + theme_minimal() +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Ländern") + theme(legend.position="none") +
geom_text(position= position_dodge(width=0.9), aes(x=Land, label=paste(count,"Fälle")), vjust=-0.5)
#fälle pro disziplin
cpd <- cpd %>% ungroup %>% arrange(-norm)
cpd$Disziplin <- factor(cpd$Disziplin, levels=unique(cpd$Disziplin))
ggplot(cpd, aes(x=Disziplin, y=norm, fill=Disziplin)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Disziplin") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Disziplin, label=paste(count,"Fälle")), vjust=-0.5)
#fälle pro kategorie
cpk <- cpk %>% ungroup %>% arrange(-norm)
cpk$Kategorie <- factor(cpk$Kategorie, levels=unique(cpk$Kategorie))
ggplot(cpk, aes(x=Kategorie, y=norm, fill=Kategorie)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Kategorie") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Kategorie, label=paste(count,"Fälle")), vjust=-0.5)
#fälle nach geschlecht
cpg <- cpg %>% ungroup %>% arrange(-norm)
ggplot(cpg, aes(x=Geschlecht, y=norm, fill=Geschlecht)) +
geom_bar(stat="identity") + ggtitle("Doping-Fälle nach Geschlecht") +
theme(legend.position="none", axis.text.x = element_text(angle=45,hjust=1), panel.background = element_rect(fill="white")) +
geom_text(position= position_dodge(width=0.9), aes(x=Geschlecht, label=paste(count,"Fälle")), vjust=-0.5)
dev.off()
